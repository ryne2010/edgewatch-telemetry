# EdgeWatch agent config

EDGEWATCH_API_URL=http://localhost:8082
EDGEWATCH_DEVICE_ID=demo-well-001
EDGEWATCH_DEVICE_TOKEN=dev-device-token-001

# Sensor backend controls
# - Default backend is mock when SENSOR_CONFIG_PATH is not set.
# - SENSOR_BACKEND overrides the backend selected in the YAML file.
# SENSOR_CONFIG_PATH=./agent/config/example.sensors.yaml
# SENSOR_BACKEND=mock
#
# Raspberry Pi BME280 example:
# SENSOR_BACKEND=rpi_i2c
# (requires `pip install smbus2`)
#
# Raspberry Pi ADS1115 example:
# SENSOR_BACKEND=rpi_adc
# (requires `pip install smbus2`)
#
# Derived oil-life model example:
# SENSOR_BACKEND=derived
# (configure state_path/oil_life_max_run_hours in SENSOR_CONFIG_PATH YAML)

# Cellular observability (Task 13b)
# Keep disabled on laptops/CI; enable on Pi nodes with ModemManager.
# CELLULAR_METRICS_ENABLED=false
# CELLULAR_MODEM_ID=0
# CELLULAR_MMCLI_TIMEOUT_S=3
# CELLULAR_MODEM_POLL_INTERVAL_S=60
#
# Link watchdog (cheap DNS + HTTP checks)
# CELLULAR_WATCHDOG_ENABLED=false
# CELLULAR_WATCHDOG_INTERVAL_S=60
# CELLULAR_WATCHDOG_DNS_HOST=www.gstatic.com
# CELLULAR_WATCHDOG_HTTP_URL=https://www.gstatic.com/generate_204
# CELLULAR_WATCHDOG_TIMEOUT_S=2.5
#
# Daily usage counters (best effort via /sys/class/net/<iface>/statistics)
# CELLULAR_INTERFACE=wwan0
# CELLULAR_USAGE_POLL_INTERVAL_S=60

# Durable daily counters used for edge policy cost-cap enforcement.
# Default includes device id in path.
# EDGEWATCH_COST_CAP_STATE_PATH=./edgewatch_cost_caps_demo-well-001.json

# Cache the last-known device policy (ETag + payload)
# Default is device-specific: ./edgewatch_policy_cache_<device_id>.json
# EDGEWATCH_POLICY_CACHE_PATH=./edgewatch_policy_cache_demo-well-001.json

# Media capture (Task 12a)
# Enable scheduled snapshots into a local ring buffer.
# MEDIA_ENABLED=false
# CAMERA_IDS=cam1
# MEDIA_SNAPSHOT_INTERVAL_S=300
# MEDIA_CAPTURE_RETRY_S=60
# MEDIA_UPLOAD_RETRY_S=60
# MEDIA_UPLOAD_BACKOFF_MAX_S=300
# MEDIA_UPLOAD_TIMEOUT_S=20
# MEDIA_ALERT_TRANSITION_MIN_INTERVAL_S=30
# MEDIA_RING_DIR=./edgewatch_media
# MEDIA_RING_MAX_BYTES=524288000
# MEDIA_CAPTURE_TIMEOUT_S=15
# MEDIA_CAPTURE_LOCK_TIMEOUT_S=5

# Local buffer (SQLite) for offline operation
BUFFER_DB_PATH=./edgewatch_buffer.sqlite
# Optional hardening controls:
# - DB size quota in bytes (oldest queued points are evicted first when exceeded)
# - WAL + pragmas for better crash resilience on edge hardware
# - batch size controls how many rows to evict per quota/disk-full event
# - corruption recovery moves malformed DB files aside and recreates schema
# BUFFER_MAX_DB_BYTES=104857600
# BUFFER_SQLITE_JOURNAL_MODE=WAL
# BUFFER_SQLITE_SYNCHRONOUS=NORMAL
# BUFFER_SQLITE_TEMP_STORE=MEMORY
# BUFFER_EVICTION_BATCH_SIZE=100
# BUFFER_RECOVER_CORRUPTION=true

# Optional: write "poison" telemetry points (validation errors) here so they
# don't block buffer flush.
# EDGEWATCH_DEADLETTER_PATH=./edgewatch_deadletter_demo-well-001.jsonl

# -----------------------------------------------------------------------------
# Fallback policy (ONLY used when /api/v1/device-policy cannot be fetched)
# In normal operation, tune contracts/edge_policy/v1.yaml instead.
# -----------------------------------------------------------------------------

SAMPLE_INTERVAL_S=30
ALERT_SAMPLE_INTERVAL_S=10
HEARTBEAT_INTERVAL_S=300
ALERT_REPORT_INTERVAL_S=60

MAX_POINTS_PER_BATCH=50
BUFFER_MAX_POINTS=5000
BUFFER_MAX_AGE_S=604800

BACKOFF_INITIAL_S=5
BACKOFF_MAX_S=300

WATER_PRESSURE_LOW_PSI=30.0
WATER_PRESSURE_RECOVER_PSI=32.0

BATTERY_LOW_V=11.8
BATTERY_RECOVER_V=12.0

SIGNAL_LOW_RSSI_DBM=-95
SIGNAL_RECOVER_RSSI_DBM=-90

# Cost caps fallback (used only when /api/v1/device-policy cannot be fetched).
MAX_BYTES_PER_DAY=50000000
MAX_SNAPSHOTS_PER_DAY=48
MAX_MEDIA_UPLOADS_PER_DAY=48

DELTA_WATER_PRESSURE_PSI=1.0
DELTA_OIL_PRESSURE_PSI=1.0
DELTA_TEMPERATURE_C=0.5
DELTA_BATTERY_V=0.05
DELTA_SIGNAL_RSSI_DBM=2
