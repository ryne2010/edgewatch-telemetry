# EdgeWatch Telemetry Contract (v1)
#
# This is a *lightweight* data contract for metric keys and expected types.
#
# Notes:
# - Unknown keys are allowed by default (additive drift).
# - Known keys must match the declared type (breaking drift is rejected).
# - Use this file to align ingest payloads, UI charts, and downstream processing.

version: v1

profiles:
  rpi_microphone_power_v1:
    default_active: true
    description: Minimal Raspberry Pi runtime profile for v1 (microphone + power management telemetry).
    metrics:
      - microphone_level_db
      - power_input_v
      - power_input_a
      - power_input_w
      - power_source
      - power_input_out_of_range
      - power_unsustainable
      - power_saver_active

metrics:
  water_pressure_psi:
    type: number
    unit: psi
    description: Water pressure at the sensor.

  microphone_level_db:
    type: number
    unit: dB
    description: Relative microphone amplitude level measured from a short capture window.

  oil_pressure_psi:
    type: number
    unit: psi
    description: Oil pressure at the sensor (when pump is on).

  temperature_c:
    type: number
    unit: celsius
    description: Ambient temperature near the device.

  humidity_pct:
    type: number
    unit: percent
    description: Ambient relative humidity near the device.

  oil_level_pct:
    type: number
    unit: percent
    description: Oil reservoir level (0-100%).

  oil_life_pct:
    type: number
    unit: percent
    description: Remaining oil life percentage (runtime-derived; manual reset).

  oil_life_reset_at:
    type: string
    description: Timestamp of the most recent manual oil-life reset in ISO-8601 UTC format.

  drip_oil_level_pct:
    type: number
    unit: percent
    description: Drip oiler reservoir level (0-100%).

  battery_v:
    type: number
    unit: volts
    description: Battery voltage.

  power_input_v:
    type: number
    unit: volts
    description: Input voltage measured by the power management sensor.

  power_input_a:
    type: number
    unit: amps
    description: Input current measured by the power management sensor.

  power_input_w:
    type: number
    unit: watts
    description: Input power measured by the power management sensor.

  power_source:
    type: string
    description: Inferred input source classification (solar|battery|unknown).

  power_input_out_of_range:
    type: boolean
    description: True when measured input voltage is outside the configured warn range.

  power_unsustainable:
    type: boolean
    description: True when sustained power load or battery trend is unsustainable.

  power_saver_active:
    type: boolean
    description: True when power management has enabled saver-mode runtime degradation.

  signal_rssi_dbm:
    type: number
    unit: dBm
    description: Cellular/WiFi RSSI (dBm).

  latitude:
    type: number
    unit: degrees
    description: Device latitude in WGS84 decimal degrees.

  longitude:
    type: number
    unit: degrees
    description: Device longitude in WGS84 decimal degrees.

  cellular_rsrp_dbm:
    type: number
    unit: dBm
    description: LTE reference signal received power (best effort from modem).

  cellular_rsrq_db:
    type: number
    unit: dB
    description: LTE reference signal received quality (best effort from modem).

  cellular_sinr_db:
    type: number
    unit: dB
    description: LTE signal-to-interference-plus-noise ratio (best effort from modem).

  cellular_registration_state:
    type: string
    description: Cellular registration state as reported by modem manager (for example home/roaming/searching).

  cellular_bytes_sent_today:
    type: number
    unit: bytes
    description: Best-effort bytes transmitted by the active network interface for the current UTC day.

  cellular_bytes_received_today:
    type: number
    unit: bytes
    description: Best-effort bytes received by the active network interface for the current UTC day.

  link_ok:
    type: boolean
    description: Connectivity watchdog result; true when DNS + HTTP checks both succeed.

  link_last_ok_at:
    type: string
    description: Last watchdog success timestamp in ISO-8601 UTC format.

  cost_cap_active:
    type: boolean
    description: True when any edge policy daily cost cap is currently active.

  bytes_sent_today:
    type: number
    unit: bytes
    description: Agent-accounted telemetry bytes sent today (UTC), used for cost-cap audit.

  media_uploads_today:
    type: number
    unit: count
    description: Agent-accounted media upload units today (UTC), used for cost-cap audit.

  snapshots_today:
    type: number
    unit: count
    description: Agent-accounted scheduled snapshots captured today (UTC).

  pump_on:
    type: boolean
    description: Whether the pump is currently running.

  flow_rate_gpm:
    type: number
    unit: gpm
    description: Flow rate (gallons per minute).

  device_state:
    type: string
    description: Optional string state emitted by the device (e.g., OK/WARN/ERROR).
