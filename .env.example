# ---- Core ----
APP_ENV=dev
LOG_LEVEL=INFO

# Logging format:
# - text (developer-friendly)
# - json (Cloud Logging friendly)
LOG_FORMAT=text

# Postgres (Docker Compose default)
DATABASE_URL=postgresql+psycopg://edgewatch:edgewatch@db:5432/edgewatch

# Automatically run Alembic migrations on API startup.
# When using docker compose, migrations are run by the `migrate` service, so keep this OFF.
# If you run the API directly (no compose), set AUTO_MIGRATE=1.
# In production, prefer running migrations as a separate Cloud Run Job (see docs).
AUTO_MIGRATE=0

# Admin key for provisioning devices (do NOT use this in prod)
ADMIN_API_KEY=dev-admin-key

# Enable/disable in-process scheduler (offline check). In production, disable this
# and trigger the Cloud Run Job entrypoint instead (python -m api.app.jobs.offline_check).
ENABLE_SCHEDULER=1

# Disable OpenAPI/docs in non-dev envs by default (override if you want docs enabled).
# ENABLE_DOCS=1

# PBKDF2 iteration count for hashing device tokens.
# Higher is slower/safer; tune for your fleet.
TOKEN_PBKDF2_ITERATIONS=210000

# Offline monitor runs every N seconds
OFFLINE_CHECK_INTERVAL_S=30

# Edge policy contract (device optimization + thresholds)
EDGE_POLICY_VERSION=v1

# Optional override (quick experimentation). Prefer editing contracts/edge_policy/*.
# DEFAULT_WATER_PRESSURE_LOW_PSI=30.0

# Telemetry data contract
TELEMETRY_CONTRACT_VERSION=v1
# If true (recommended), known metrics must match the declared type.
# Unknown keys are still accepted (additive drift) but recorded in ingestion batches.
TELEMETRY_CONTRACT_ENFORCE_TYPES=1
# Unknown keys: allow|flag (flag records drift events without blocking ingest)
TELEMETRY_CONTRACT_UNKNOWN_KEYS_MODE=allow
# Type mismatches: reject|quarantine
TELEMETRY_CONTRACT_TYPE_MISMATCH_MODE=reject

# Alert routing + delivery adapter (webhook/slack)
ALERT_DEDUPE_WINDOW_S=900
ALERT_THROTTLE_WINDOW_S=3600
ALERT_THROTTLE_MAX_NOTIFICATIONS=20
ALERT_QUIET_HOURS_START=22:00
ALERT_QUIET_HOURS_END=06:00
ALERT_QUIET_HOURS_TZ=UTC
# ALERT_WEBHOOK_URL=
ALERT_WEBHOOK_KIND=generic
ALERT_WEBHOOK_TIMEOUT_S=5

# Optional event-driven ingest mode
INGEST_PIPELINE_MODE=direct
INGEST_PUBSUB_TOPIC=edgewatch-telemetry-raw
# INGEST_PUBSUB_PROJECT_ID=your-project-id
# Optional shared token for /api/v1/internal/pubsub/push
# INGEST_PUBSUB_PUSH_SHARED_TOKEN=replace-me

# Optional analytics export lane
ANALYTICS_EXPORT_ENABLED=0
# ANALYTICS_EXPORT_BUCKET=your-bucket
ANALYTICS_EXPORT_DATASET=edgewatch_analytics
ANALYTICS_EXPORT_TABLE=telemetry_points
ANALYTICS_EXPORT_GCS_PREFIX=telemetry
ANALYTICS_EXPORT_MAX_ROWS=50000

# CORS (set to * for local dev only)
CORS_ALLOW_ORIGINS=*

# If enabled, creates a demo device automatically on startup (dev only)
BOOTSTRAP_DEMO_DEVICE=1
# Number of demo devices to create. If DEMO_DEVICE_ID/NAME/TOKEN end with `001`,
# the remaining devices will be derived by incrementing that 3-digit suffix.
DEMO_FLEET_SIZE=3
DEMO_DEVICE_ID=demo-well-001
DEMO_DEVICE_NAME=Demo Well 001
DEMO_DEVICE_TOKEN=dev-device-token-001
